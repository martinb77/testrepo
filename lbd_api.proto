syntax = "proto3";
 
option java_package = "com.bmw.psmg.hub.externalservices.api.bompositions";
option java_multiple_files = true;
 
/*
 * Top level entity for the BoM-List request.
 */
message BomListRequest {
 
    // MANDATORY PARAMETERS
 
    /*
     * 4 character plant code in SAP notation.
     * Interpretation whether this code is MO (vehicle assembly location) or BO (demand location)
     * is done by the parameter 'plantMatchingMode'
     *
     * FORMAT: [A-Z0-9]{4}
     * USAGE: Mandatory
     * DEFAULT: -
     * EXAMPLE: "A110"
     */
    string plantCode = 1;
 
    /*
     * Specify the matching mode for the given plantCode.
     * If a vehicle-component is not assembled in the vehicle assembly plant (MO) it must be delivered to another
     * plant which assembles the part to a component.
     *
     * FORMAT: Enumeration
     * USAGE: Mandatory
     * DEFAULT: -
     * EXAMPLE: MO_OR_BO
     */
    PlantMatchingMode plantMatchingMode = 2;
 
    // OPTIONAL PARAMETERS
    // We start with protobuf numbers from 10 - leaving specification space for updates of the mandatory ones.
 
    /*
     * PSMG Hub covers BoM positions which are current (=relevant for demands) and older, possible deprecated.
     * This parameter causes HUB to filter out BoM position versions which have a runOutDate (ATERMIN) older than 'earliestRunOutDate'.
     *
     * FORMAT: yyyy-MM-dd
     * USAGE: Optional
     * DEFAULT: - (all versions that do exist in HUB will be fetched)
     * EXAMPLE: "2019-08-01"
     */
    string earliestRunOutDate = 10;
 
    /*
     * PSMG Hub contains logistic relevant BoM positions and also non-logistic relevant ones.
     * This parameter causes HUB to filter out bom positions which are not logistic relevant.
     *
     * FORMAT: [true | false]
     * USAGE: Optional
     * DEFAULT: false
     * EXAMPLE: true
     */
    bool filterLogisticRelevance = 11;
 
    /*
     * Status code(s) of the BoM position.
     * Filter out all BoM positions with non-matching status.
     *
     * FORMAT: [A-Z0-9]{1}
     * USAGE: Optional
     * DEFAULT: -
     * EXAMPLE: ["0", "1", "P", "B"]
     */
    repeated string tvnState = 12;
 
    /*
     * 4 character model codes which the BoM positions have to match.
     * Filter out all other model codes which do not match these.
     *
     * FORMAT: [A-Z0-9]{4}
     * USAGE: Optional
     * DEFAULT: -
     * EXAMPLE: ["JA11", "7K31"]
     */
    repeated string modelCodes = 13;
 
    /*
     * PSMG Hub does operate with data versions. E. g. each update of a dataset causes a new version.
     * To have consistent data - or/and to use a specific version of the data, this parameter has to be used.
     *
     * In particular this is required by the so-called critical path demand calculation.
     * To receive the dataVersion token, the caller must call the service 'GetDataVersions' first.
     *
     * ATTENTION:
     * - This is a server-side computed token, DO NOT MODIFY on client-side.
     * - The token may expire over a longer period of time (=the data version is no longer available) DO NOT PERSIST on client-side.
     *
     * FORMAT: Token
     * USAGE: Optional
     * DEFAULT: (LATEST data version)
     * EXAMPLE: dGhpcyBpcyBhbiBpbnRlcm5hbCBpbXBsZW1lbnRhdGlvbiBkZXRhaWw= (only for illustration - DO NOT USE!)
     */
    string dataVersion = 14;
 
}
 
/*
 * Matching mode to indicate the search-context of the 'plantCode'
 */
enum PlantMatchingMode {
    MO = 0; //Match plantCode only to MO (plant code where the vehicle is being assembled)
    BO = 1; //Match plantCode only to BO (plant code where the part is assembled)
    MO_OR_BO = 2; //Match all BoM-Positions which either have the specified plantCode as MO or BO set
    MO_AND_BO = 3; //Match all BoM-Positions which have the specified plantCode in MO AND BO set
}



/*
 * Top level entity for the BoM-List response.
 */
message BomListResponse {
 
    /*
     * PSMG Hub does operate with data versions. E. g. each update of a dataset causes a new version.
     *
     * This is the dataVersion which the contained data is from.
     *
     * ATTENTION:
     * - This is a server-side computed token, DO NOT MODIFY on client-side.
     * - The token may expire over a longer period of time (=the data version is no longer available) DO NOT PERSIST on client-side.
     *
     * FORMAT: Token
     * USAGE: Mandatory
     * DEFAULT: (LATEST data version)
     * EXAMPLE: dGhpcyBpcyBhbiBpbnRlcm5hbCBpbXBsZW1lbnRhdGlvbiBkZXRhaWw= (only for illustration - DO NOT USE this value!)
     */
    string dataVersion = 1;
 
    /*
     * List of fetched BoM positions.
     *
     * FORMAT: List of <Error>
     * USAGE: Optional
     * DEFAULT: []
     */
    repeated BomPosition bomPositions = 10;
 
    /*
     * List of occurred errors.
     *
     * FORMAT: List of <Error>
     * USAGE: Optional
     * DEFAULT: []
     */
    repeated Error errors = 20;
 
}
 
message BomPosition {
    /*
     * Assembly plant code (Montagewerk - "MO"), in SAP notation, of this BoM-position.
     *
     * FORMAT: [A-Z0-9]{4}
     * USAGE: Mandatory
     * DEFAULT: -
     * EXAMPLE: "A110"
     */
    string plantCode = 1;
 
    /*
     * 4 character model code.
     *
     * FORMAT: [A-Z0-9]{4}
     * USAGE: Mandatory
     * DEFAULT: -
     * EXAMPLE: "JA11"
     */
    string modelCode = 2;
 
    /*
     * Unique ID across assembly position. This is the TAIS FixPosT value for positions on structure level 0 and the
     * TAIS FixZus value for position on structure level > 0
     *
     * FORMAT: [A-Z0-9]*
     * USAGE: Optional
     * DEFAULT: ""
     * EXAMPLE: "59123583"
     */
    string positionId = 3;
 
    /*
     * Part number of the part usage.
     * Note: Part numbers with length < 10 are NOT filled up with blanks.
     *
     * FORMAT: [A-Z0-9]{7-10}
     * USAGE: Mandatory
     * DEFAULT: -
     * EXAMPLE: "9391187"
     */
    string partNumber = 4;
 
    /*
     * Structure level of this BoM-position, meaning the number of predecessors in the assembly hierarchy.
     *
     * FORMAT: [0-9]*
     * USAGE: Optional
     * DEFAULT: "0"
     * EXAMPLE: "0"
     */
    int32 structureLevel = 5;
 
    /*
     * The sourcing type (German: Bezugsart), which can be in-house and purchase part.
     * 'B' of BTCH attributes from TAIS
     *
     * FORMAT: Alphanumeric
     * USAGE: Optional
     * DEFAULT: ""
     * EXAMPLE: "A"
     */
    string sourcingType = 6;
 
    /*
     * The part type (German: Teileart), e.g., single part, assembly, delivery contents, etc.
     * 'T' of BTCH attributes from TAIS
     *
     * FORMAT: Alphanumeric
     * USAGE: Optional
     * DEFAULT: ""
     * EXAMPLE: "M"
     */
    string partType = 7;
 
    /*
     * The character code (German: Charakterschlüssel), which contains production part, consumable,
     * trim part colour or all colours, etc.
     * 'CH' of BTCH attributes from TAIS
     *
     * FORMAT: Alphanumeric
     * USAGE: Optional
     * DEFAULT: ""
     * EXAMPLE: "PH"
     */
    string characterCode = 8;
 
    /*
     * Unified parts grouping (aka construction group - Konstruktionsgruppe).
     *
     * FORMAT: K[0-9]{4}
     * USAGE: Mandatory
     * DEFAULT: -
     * EXAMPLE: "K6112"
     */
    string upg = 9;
 
    /*
     * Standardized structuring of planning content (aka product process group - Produktprozessgruppe).
     *
     * FORMAT: P[0-9]{4}_[0-9]{3}
     * USAGE: Optional
     * DEFAULT: ""
     * EXAMPLE: "P6112_012"
     */
    string ppg = 10;
 
    /*
     * The module organization breaks down the product structure into business modules.
     * A module organization is a group within the BMW group responsible for a certain aspect of engineering.
     *
     * FORMAT: Alphanumeric
     * USAGE: Optional
     * DEFAULT: ""
     * EXAMPLE: "CB02"
     */
    string moduleOrg = 11;
 
    /*
     * The quantity of this position required to build the model-type.
     * Decimal format with "." as separator.
     *
     * FORMAT: [0-9]{1,}\.[0-9]{1,}
     * USAGE: Mandatory
     * DEFAULT: -
     * EXAMPLE: "1.0"
     */
    string quantity = 12;
 
    //connected entities
 
    /*
     * List of children of this BoM-Position.
     *
     * FORMAT: List of <BomPosition>
     * USAGE: Optional
     * DEFAULT: []
     */
    BomPosition children = 20;
 
    /*
     * List of historic layers of this BoM-Position.
     *
     * FORMAT: List of <BomPositionVersion>
     * USAGE: Mandatory
     * DEFAULT: -
     */
    repeated BomPositionVersion bomPositionVersions = 21;
 
    /*
     * List of MoBo rules for this BoM-Position.
     *
     * FORMAT: List of <MoboRule>
     * USAGE: Optional
     * DEFAULT: []
     */
    repeated MoboRule moboRules = 22;
 
    /*
     * List of material versions (ChangeIndex) for this BoM-Position.
     *
     * FORMAT: List of <MaterialVersion>
     * USAGE: Optional
     * DEFAULT: []
     */
    repeated MaterialVersion materialVersions = 23;
 
 
}
 
/*
 * A message containing a history level of a BoM position.
 *
 * A BoM-Position version is also known as "history level" and is specific to model type, plant and NRCL.
 */
 
message BomPositionVersion {
 
    /*
     * NRCL (New release and Change List - German "Neuanlage Änderungsliste - NAEL") code with which
     * this BoM-position was created or changed.
     *
     * FORMAT: Alphanumeric
     * USAGE: Mandatory
     * DEFAULT: -
     * EXAMPLE: "E1D394"
     */
    string runInNrcl = 1;
 
    /*
     * NRCL of the next effective historical layer.
     * Will be absent, if this is the "last" historic layer.
     *
     * FORMAT: Alphanumeric
     * USAGE: Optional
     * DEFAULT: ""
     * EXAMPLE: "E1D394"
     */
    string runOutNrcl = 2;
 
    /*
     * Validity start-date of this BoM-Position (ETERMIN).
     *
     * FORMAT: YYYY-MM-DD
     * USAGE: Optional
     * DEFAULT: -
     * EXAMPLE: "2019-10-28"
     */
    string runInDate = 3;
 
    /*
     * The run-out-date of this historical layer.
     * If not set (open end) this will be 9999-12-31.
     *
     * FORMAT: YYYY-MM-DD
     * USAGE: Optional
     * DEFAULT: -
     * EXAMPLE: "2019-10-28"
     */
    string runOutDate = 4;
 
    /*
     * Status code(s) of the BoM position.
     * Filter out all BoM positions with non-matching status.
     *
     * FORMAT: Alphanumeric
     * USAGE: Optional
     * DEFAULT: -
     * EXAMPLE: "1"
     */
    string tvnState = 5;
 
    /*
     * The dispo code encodes how a part is acquired (AG: internal production, L1: supplied by local vendor) and where
     * it is used in construction (L0: engine plant, OD: not needed at all).
     *
     * May be " " ("import from Germany") - do NOT trim this field.
     *
     * FORMAT: Alphanumeric
     * USAGE: Optional
     * DEFAULT: ""  - This means the field is not set, do not confuse with "  " (two spaces) which has a business meaning
     * EXAMPLE: "L1"
     */
    string dispoCode = 6;
 
    /*
     * The boolean expression for SA-LA-PA (Sonderausstattung, Länderausstattung, Paketausstattung) in TAIS notation.
     *
     * FORMAT: Alphanumeric
     * USAGE: Optional
     * DEFAULT: ""
     * EXAMPLE: "(((S3DSA)&(S778A)) &NOT(L807A/P337A/S322A/S9XAA))"
     */
    string salapaBoolean = 7;
 
    /*
     * BDQV Number (Basis-Daten-Qualitäts-Verfolgung Nummer) will be set when this BomPosition was changed
     * by SQUSI.
     *
     * FORMAT: Alphanumeric
     * USAGE: Optional
     * DEFAULT: ""
     * EXAMPLE: "12345"
     */
    string bdqvNumber = 8;
 
    /*
     * Colour exception code. Also known as "EC-Code".
     *
     * FORMAT: Alphanumeric
     * USAGE: Optional
     * DEFAULT: ""
     * EXAMPLE: "SLMAA"
     */
    string colourExceptionCode = 9;
 
    /*
     * Combinations of upholstery and interior colours for which this part is valid. It follows the syntax
     * <upholstery_code>/<interior_colour_code> or only <upholstery_code>.
     *
     * FORMAT: [A-Z0-9]{2}\/[A-Z0-9]{2}
     * USAGE: Optional
     * DEFAULT: []
     * EXAMPLE: ["BD/AT", "CC/L1"]
     */
    repeated string interiorCodes = 10;
 
    /*
     * Paint colours for which this part is valid.
     *
     * FORMAT: Alphanumeric
     * USAGE: Optional
     * DEFAULT: []
     * EXAMPLE: ["U300", "SLMAA"]
     */
    repeated string paintColourCodes = 11;
 
    /*
     * Indicates, whether this position is logistic relevant or not.
     *
     * FORMAT: bool
     * USAGE: Mandatory
     * DEFAULT: false
     * EXAMPLE: true
     */
    bool logisticRelevance = 12;
 
    /*
     * Indicates, whether this position is dispo-relevant or not.
     *
     * FORMAT: bool
     * USAGE: Mandatory
     * DEFAULT: false
     * EXAMPLE: true
     */
    bool dispoRelevance = 13;
 
}
 
message MoboRule {
    /*
     * The demand location (BO - Bedarfsort) is the plant where the part is logistically relevant. This may differ
     * from the vehicle assembly plant (MO). These are determined by so called "MOBO-rules"
     *
     * FORMAT: [A-Z0-9]{4}
     * USAGE: Mandatory (because the rule itself is optional, but when it does exist, it always has a BO set).
     * DEFAULT: -
     * EXAMPLE: "A120"
     */
    string bo = 1;
 
    /*
     * The NRCL of the applied BO-rule. Also known as "B-NAEL".
     *
     * FORMAT: Alphanumeric
     * USAGE: Mandatory
     * DEFAULT: -
     * EXAMPLE: "3F542B"
     */
    string nrcl = 2;
 
    /*
     * Validity start-date of the MOBO rule.
     *
     * FORMAT: YYYY-MM-DD
     * USAGE: Mandatory
     * DEFAULT: -
     * EXAMPLE: "2020-10-28"
     */
    string runInDate = 3;
 
}
 
message MaterialVersion {
    /*
     * The CI (ChangeIndex - German "Änderungsindex") specifies a new version of a material. The new version has different
     * physical properties, but can be used instead of the old one anyway.
     *
     * FORMAT: Numeric
     * USAGE: Mandatory
     * DEFAULT: 0
     * EXAMPLE: 1
     */
    int32 ci = 1;
 
    /*
     * The NRCL code references the formal Release and Change List (NRCL) that expresses the version
     * of a BomPosition. The NRCL is a list of constructive part changes as well as new or changed
     * usages of available parts (e.g. using of available parts with changed quantity). NRCL contains
     * the released bill of material.
     *
     * FORMAT: Alphanumeric
     * USAGE: Mandatory
     * DEFAULT: ""
     * EXAMPLE: "E7C799"
     */
    string nrcl = 2;
 
    /*
     * Validity start-date of the CI.
     *
     * FORMAT: YYYY-MM-DD
     * USAGE: Mandatory
     * DEFAULT: -
     * EXAMPLE: "2014-12-01"
     */
    string runInDate = 3;
 
    /*
     * Validity end-date of the CI.
     * If not set (open end) this will be 9999-12-31.
     *
     * FORMAT: YYYY-MM-DD
     * USAGE: Mandatory
     * DEFAULT: -
     * EXAMPLE: "2014-12-01"
     */
    string runOutDate = 4;
 
    /*
     * Package of the CI.
     *
     * FORMAT: Alphanumeric
     * USAGE: Optional
     * DEFAULT: ""
     * EXAMPLE: "19Y490"
     */
    string runInPackage = 5;
 
}
 
/*
 *
 */
message Error {
    /*
     * Some descriptive error text in english.
     *
     * FORMAT: String
     * USAGE: Optional
     * DEFAULT: ""
     * EXAMPLE: "Mandatory field 'plantCode' is missing."
     */
    string message = 1;
 
    /*
     * Category/type of the error.
     *
     * FORMAT: Enum
     * USAGE: Mandatory
     * DEFAULT: UNDEFINED
     * EXAMPLE: REQUIRED_FIELD_MISSING
     */
    Type type = 2;
 
    enum Type {
        UNDEFINED = 0; // Error without further specification
        REQUIRED_FIELD_MISSING = 1; // a required field has not been set
        INVALID_FIELD = 2; // the format or value for a field is not correct
        DATA_VERSION_INVALID = 3; // specified dataVersion in request is unknown (or no longer available)
        REQUEST_ENTITY_TOO_LARGE = 4; // result size too big
        TOO_MANY_REQUESTS = 5; // api was called too often
        SERVER_ERROR = 20; // internal server error
    }
 
}
